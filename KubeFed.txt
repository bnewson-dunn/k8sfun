# kubefed_setup.sh: Create a Federated Cluster with KubeFed

#!/bin/bash

# 1. Install Helm (if not already installed)
curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash

# 2. Add KubeFed Helm Repository and Install KubeFed
helm repo add kubefed-charts \
https://raw.githubusercontent.com/kubernetes-sigs/kubefed/master/charts

helm repo update

helm install kubefed kubefed-charts/kubefed --namespace kube-federation-system \
--create-namespace

# 3. Download and Install kubefedctl
wget https://github.com/kubernetes-sigs/kubefed/releases/download/v0.8.1/kubefedctl-linux-amd64.tgz

tar -zxvf kubefedctl-linux-amd64.tgz

sudo mv kubefedctl /usr/local/bin/

# 4. Join Clusters to the Federation
# List Available Contexts
kubectl config get-contexts

# Join Clusters Using kubefedctl (replace <cluster-name> and <cluster-context> with your details)
kubefedctl join <cluster-name> --cluster-context <cluster-context> \
--host-cluster-context <host-cluster-context> --v=2

# Example: If both the host and member clusters are the same
kubefedctl join mycluster --cluster-context mycluster \
--host-cluster-context mycluster --v=2
